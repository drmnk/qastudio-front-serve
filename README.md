# Сервировка фронтенда

## Как развернуть фронтенд для тестирования на своем компьютере

На самом деле - очень просто! Зачастую нам достаточно ввести пару команд в консоли и мы получим работающий сайт в браузере уже через несколько секунд. А иногда достаточно и просто открыть файл "index.html" в папке с сайтом и всё заработает. 

Но бывает по-всякому, и наша главная задача - разобраться, как сделан фронт и по-правильному его "сервировать", чтобы начать работу. Чаще всего к этому процессу будет прилагаться инструкция прямо в архиве/репозитории проекта или разработчик быстро всё объяснит на словах. 

Но если разработчик-лентяй молчит как рыба об лёд и не позаботился о нормальной документации по развёртыванию проекта - больно надо, обойдёмся без него.

---

## Предварительные требования
Для этого урока нам понадобятся установленные на вашей машине **node** и **git**.

> **Node.js** - среда выполнения JavaScript, перенесённая из браузера на компьютер. Тем самым JavaScript стал доступен не только разработчикам фронта, но и бэкенд-программистам и куче других специальностей (даже инженерам микроконтроллеров).
>
> Поставляется сразу с пакетным менеджером **NPM**, который позволяет быстро находить в огромном реестре пакеты (готовые кусочки кода), которые можно переиспользовать в своём проекте.

> Git - система управления версиями и совместного доступа к коду. Это может звучать страшновато, но мы будем рассматривать это как более удобный способ скачать папку с кодом себе на компьютер. Скоро git станет вашим лучшим другом

Как сказано выше - нам не всегда понадобятся эти программы для развёртки фронта для тестирования. Но в профессии они точно не будут лишними.

---

## Установка Node и Git
Так как мы уже взрослые и серьёзные специалисты, для установки ПО мы будем пользоваться пакетными менеджерами - это такие специальные программы, которые устанавливают другие программы для нас. 

> Стандартный процесс установки нужной программы на Windows и Mac - зайти на сайт разработчика, найти там кнопку скачать. После чего запустить скачанный файл и пощёлкать мышкой в мастере установки.
>
> Но в разработке ПО и вебсайтов многие программы, которые нам нужны - консольные. Или слишком крошечные, чтобы делать для них инсталлятор. Или это вообще не программа, а библиотека для обработки PNG-картинок и к ней можно получить доступ только программно. 
>
> А если учесть, что зачастую среды для разработки или для реального размещения сайтов на серверах разворачиваются полностью автоматически - "графический" подход становится попросту профнепригоден.

Поэтому вам обязательно нужно познакомиться с пакетными менеджерами - возможно, они станут вашими лучшими друзьями. Через них можно установить практически всё. Для пользователей Windows или Mac это может показаться сперва непривычным, а вот пользователи *nix систем типа Ubuntu давно к этому привыкли.

Пакетный менеджер - это совокупность программы и собственно **реестра пакетов** - уже скомпилированных и готовых к установке программ, которые добрые самаритяне собрали для нас.

### **Установка на MacOS**
На маке нет пакетного менеджера, но **Homebrew** (https://brew.sh) - это то, что должно быть установлено у каждого пользователя. У него даже слоган такой - *The Missing Package Manager for macOS (or Linux)*

Как и всё в мире маков и айфонов - процесс работы и установки очень прост и понятен. Всё что нам нужно сделать - открыть программу "Терминал" (Нажмите Cmd + пробел и введите 'term') и в ней запустите команду с главной страницы сайта:

```
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```
*Примечание - команда может поменяться, поэтому желательно всё же скопируйте её с главной страницы Homebrew*

После этого Хоумбрю подробно распишет, что он собирается сделать, спросит у вас разрешение и задумается на некоторое время. Насколько долго - это зависит от скорости вашего интернет соединения и мощности Мака.

После того, как он закончит, на всякий случай перезапустите Терминал, чтобы система точно подхватила новые переменные окружения.

> Сейчас мы не будем задерживаться на том, что такое переменные окружения - по факту это тема для такой же, если не больше, статьи. Пока просто перезапустите Терминал и всё будет в шоколаде :)

Реестр пакетов Homebrew живёт на https://formulae.brew.sh - там вы можете найти команды для установки практически любой необходимой для разработки программы.

Теперь для установки node и git нам достаточно запустить в терминале следующий код:

```
brew install node git
```

Проверьте, что всё установилось и работает:
```
node -v
# Вывод должен быть вроде такого - v19.4.0

git -v
# Вывод должен быть вроде такого - git version 2.37.1
```

При помощи Homebrew можно устанавливать и обновлять не только консольные приложения, но и вполне обычные "большие" программы, например VS Code.

```
brew install --cask visual-studio-code
```

### **Установка на Windows**
Для Windows идея пакетного менеджера долгое время отвергалась, но в итоге Chocolatey (https://chocolatey.org) заслужил своё место под солнцем. Установка его немного более замороченная, чем установка Homebrew для мака, но мы справимся.

Первым делом - нам нужен нормальный Терминал для Windows. Командная строка cmd.exe - уже не котируется даже самими Майкрософт. Хорошо, что они начали разворачиваться лицом к open-source и сами выпустили очень мощный Терминал: https://apps.microsoft.com/store/detail/windows-terminal/9N0DX20HK701

На странице есть инструкция по установке его с помощью Microsoft Store.

Теперь приложение **"Терминал"** будет доступно в вашей системе. Чтобы приступить к установке пакетного менеджера, нам нужно открыть Терминал с правами администратора.

Для этого в меню поиск наберём "Терм" и в предложенных приложениях должен отобразиться "Терминал". Щёлкнем по нему правой кнопкой и выберем "Запуск от имени администоратора"

Процесс установки описан на https://chocolatey.org/install, но приведём его также здесь:

```
# Первые две команды не относятся непосредственно к установке Chocolatey - эти команды настраивают политику безопасности так, чтобы Терминал мог скачать и запустить скрипт установки

Set-ExecutionPolicy AllSigned

Set-ExecutionPolicy Bypass -Scope Process

# Всё, что внизу, нужно скопировать одним блоком
Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
```
*Примечание - команда может поменяться, поэтому желательно всё же скопируйте её со страницы установки Chocolatey*

После того, как он закончит, на всякий случай перезапустите Терминал (снова в режиме Администратора - Чоколати работает так), чтобы система точно подхватила новые переменные окружения.

> Сейчас мы не будем задерживаться на том, что такое переменные окружения - по факту это тема для такой же, если не больше, статьи. Пока просто перезапустите Терминал и всё будет в Chocolate :)

Реестр пакетов Homebrew живёт на https://community.chocolatey.org/packages - там вы можете найти команды для установки практически любой необходимой для разработки программы.

Теперь для установки node и git нам достаточно запустить в терминале следующий код:

```
choco install nodejs git
```

Чоколати будет постоянно спрашивать - мол, установить ли мне это приложение, запустить этот скрипт? Просто отвечайте "y" и жмите Enter.

После проверьте, что всё установилось и работает:
```
node -v
# Вывод должен быть вроде такого - v19.4.0

git -v
# Вывод должен быть вроде такого - git version 2.37.1
```

### **Установка на Linux системы**
Я думаю, вы и так прекрасно знаете, как пользоваться пакетным менеджером в вашей системе. И скорее всего, у вас уже даже установлен git. И практически наверняка вы можете установить Node.js в одну строчку. 

Но бывает так, что версии в официальных репозиториях операционной системы устарели. Поэтому лучше добавить репозиторий разработчиков Ноды, чтобы иметь доступ к актуальным версиям. Вы можете найти репозитории для вашей системы и инструкции по установке здесь - https://nodejs.org/en/download/package-manager/

Установка на Ubuntu, например, происходит так:
```
curl -fsSL https://deb.nodesource.com/setup_19.x | sudo -E bash - &&\
sudo apt-get install -y nodejs
```
*Примечание: у вас может быть не установлен **curl** - в этом случае просто выполните `sudo apt install curl`*

Git не обязательно обновлять до последних версий - обычно даже старые версии прекрасно справляются с базовыми задачами

После проверьте, что всё установилось и работает:
```
node -v
# Вывод должен быть вроде такого - v19.4.0

git -v
# Вывод должен быть вроде такого - git version 2.37.1
```
---


## Разворачивание сайта на локальной машине
Что же, добрались до самого интересного.

Итак, разворачиваем фронт. 

> Так, давайте только сперва немного разберёмся с терминологией. Фронтом мы сейчас будем называть всё то, что может отображаться в браузере без необходимости в серверной генерации. 
>
> По факту когда серверный язык типа PHP генерирует и показывает нам страницы - это по факту тоже фронт, "отображение". 
>
> Но в этом уроке мы концентрируемся только на тех вариантах, которые являются по сути отдельными приложениями, а если и обращаются к серверу, то делают это сами, через запросы к сторонним API в браузере.

Рассмотрим три различных варианта по возрастающей сложности

### **Статические страницы без внешних запросов**
Да, сайт не должен быть очень сложным. Сайты с документацией, блоги, лэндинги - по факту могут представлять из себя просто набор страничек с гиперссылками между ними. Какой-нибудь лендинг, к примеру - просто одна страничка со стилями и формой обратного отзыва, для обработки которой используется немного JavaScript

Пример - сайт-портфолио из учебного проекта по HTML/CSS. Свободно опубликован на Github здесь: https://github.com/john-smilga/html-css-portfolio-project-with-css-grid

Загрузим его к себе на компьютер через Git (да, можно нажать на кнопку <> Code и скачать в виде zip-архива, но мы зря git устанавливали что ли?):

```
git clone https://github.com/john-smilga/html-css-portfolio-project-with-css-grid.git
```

В той папке, где вы запустили эту команду, у вас появится папка "html-css-portfolio-project-with-css-grid". Откройте в ней файл index.html

Та-да! Всё работает. Не удивляйтесь, такое можно встретить и в некоторых реальных проектах. Вы можете походить по страничкам (Заметили окончание *.html в адресной строке браузера?).

Всё может быть очень просто.

### **Статический сайт с внешними запросами**
А теперь давайте поглядим на пример магазина мебели, написаного на простом JavaScript.

```
git clone https://github.com/john-smilga/javascript-comfy-store-course-project.git
```

Зайдите в папку **final** - это учебный проект, поэтому в базовой директории находится пустой шаблон, а готовое - в папке **final**

Там нет ничего мудрёного, никаких пакетов, реактов, вью и всего такого. Также видны странички с простым HTML. Но вы попробуйте запустить index.html браузером и прокрутить страничку чуть вниз. Там должны быть примеры нескольких элементов мебели.

Нет ничего? Давайте откроем консоль:
```
Запрос из постороннего источника заблокирован: Политика одного источника запрещает чтение удаленного ресурса на file:///Users/denis/Downloads/javascript-comfy-store-course-project-master/final/index.js. (Причина: запрос CORS выполнен не по http).
```

Да, файлам (а HTML-странички - это просто файлы, которые отображает браузер) много что запрещено. Например - обращаться по HTTP к сторонним сайтам (тут сайт пытается выполнить запрос по API к внешнему ресурсу, на котором расположена информация о мебели и картинки).

Незадача. Браузер хочет, чтобы мы предъявили ему настоящий сайт. Как это сделать? На самом деле - с Node.js это очень просто.

Входим в папку сайта и устанавливаем глобально пакет "serve":
```
npm install --global serve
```
*Примечание: npm - это пакетный менеджер мира javascript, устанавливается вместе с Node.js*

И после установки выполняем в папке **final**...
```
serve
```

В ответ получаем следующую плашку:
```

   ┌────────────────────────────────────────┐
   │                                        │
   │   Serving!                             │
   │                                        │
   │   - Local:    http://localhost:3000    │
   │   - Network:  http://10.0.0.7:3000     │
   │                                        │
   │   Copied local address to clipboard!   │
   │                                        │
   └────────────────────────────────────────┘
```

Заходим на http://localhost:3000 - да это же наш магазин мебели! И он работает! 

Всё дело в том, что мы установили **настоящий веб-сервер** в качестве пакета NPM, а NPM нам его ещё и зарегистрировал как глобальное приложение **serve**.

И теперь мы легко можем хостить на своём компьютере любой статический сайт, готовое SPA (одностраничное приложение) или обычные файлы, которым нужно обращаться куда-то в интернет или подключать JavaScript как модуль.

Этот сервер даже сделал нам "красивые пути" - вырезав расширение "*.html" из адресной строки.

Попробуйте сами так "захостить" портфолио из первого примера. Если после запуска сервера вы не можете открыть сайт по **localhost:3000**, внимательно посмотрите, какой порт стоит в выводе команды, там где "localhost" - возможно, какая-то программа занимает этот порт (возможно, тот же самый serve, но запущенный в другом терминале). В этом случае serve сам подберёт свободный порт - заходите по нему

### **Одностраничные приложения и статически генерируемые сайты**

Не всегда к нам в руки попадают сайты, где есть что открыть. Там просто может даже не быть папки, в которую нам надо зайти, чтобы запустить сервер.

Как пример - приложения на React/Vue, где сперва куча внутренних процессов должны произойти, чтобы нам куда-то предъявили страничку, которая что-то отобразит.

Или статический генератор сайтов по типу Jekyll или 11ty, который может представлять из себя просто кучу файлов в Markdown.

Для того, чтобы получить что-то пригодное для просмотра - надо:
1. Удостовериться, что у нас установлены все необходимые зависимости
2. Сгенерировать сайт ("сбилдить" - build)
3. А после этого уже смотреть

Перейдём к практике - давайте откроем в VS Code папку с вот этим приложением, написанным на Реакте:

```
git clone https://github.com/murators53/nikeStore-Eccommerse-tsredux.git
```

Да, там есть папка "public". Да, в ней есть файл index.html. Да, мы можетм даже выполнить в папке "public" команду "serve". Нет, вы ничег там не увидите (кстати, про это там так и написано).

**Мы можем понять, что дело пахнет Node.js и сборкой, когда видим в корне проекта файл "package.json".** 

Это основная точка входа в проект для пакетного менеджера NPM и обычного там внутри прописаны скрипты, которые нужно выполнить для запуска проекта.

Давайте откроем его. Там будет много разных настроек и определений, но нас интересует только одна секция - **"scripts"**:

```
...
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
...
```

То, что нужно! Мы можем запускать эти скрипты с помощью команды **npm run** (да, это не только пакетный менеджер, но ещё и чтец, жнец...). Давайте сразу попробуем запустить проект командой start.

```
npm run start

# А это мы получим в ответ:
> typescript-nike-react@0.1.0 start
> react-scripts start

sh: react-scripts: command not found
```

Чего-то не хватает. Дело в том, что для того, чтобы проект заработал - ему нужно много зависимостей, других кусочков кода, на который он опирается. Их не распространяют вместе с кодом - потому проект размером в 10 Кб может тянуть за собой 100 Мб зависимостей.

Чтобы установить все зависимости - выполним команду
```
npm install
```

NPM за пару минут всё для нас сделает. Теперь снова попробуем запустить npm start
```
npm start
# с командой старт мы можем опустить слово run - кстати, ещё его можно не писать с командой test (для запуска тестов)
```

Вот теперь у вас должен самостоятельно запуститься сайт с кучей кроссовочек! Красота, поглядим, походим. Но как это получилось? Давайте пока скажем, что это магия. Давайте вернёмся обратно в папку проекта. 

Хорошо, а можем ли мы применить полученные в прошлых примерах знания и как-то "захостить" этот сайт самостоятельно? По факту же это - просто SPA-приложение, его можно разместить на простом хостинге типа Netlify или GitHub Pages и всё должно работать. 

Ответ простой - пока нет. Но давайте запустим теперь скрипт build:
```
npm run build
```

Что изменилось в папке проекта? Правильно, появилась папка "build" - а вот именно в ней уже лежит наш простой, привычный сайт. 

Мы можем зайти в эту папку и запустить там serve. Можем опубликовать её. Можем удалить и сформировать заново (что, кстати, придётся сделать, если мы изменим код самого приложения - даже одну буковку).

Зачем такие сложности? Всё дело в том, что SPA-приложения на реакте/вью/свелте - это совершенно не про веб-страницы. Это про JavaScript-компоненты, которые общаются между собой и в итоге формируют нам вид нашего приложения. Внутри таких приложений есть так называемые "сборщики", одна из задач которых - из кучи разрозненных файлов сделать нам одно приложение.

И когда мы меняем код приложения - по факту сборщику нужно чуть ли не заново его пересобирать. Поэтому, в целях повышения производительности и простоты отладки, в основной папке приложение лежит несжатое. Так сборщику гораздо проще обновлять части приложения, а не всё его целиком, а программистам отслеживать ошибки.

А вот когда мы уже публикуем приложение - сборщик проводит работу по оптимизации, делая приложение максимально компактным и быстрым. Зайдите в папку build, найдите там файл с JavaScript кодом:
```
!function(){"use strict";var e={110:function(e,t,n){var r=n(309),a={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},l={};function u(e){return r.isMemo(e)?i:l[e.$$typeof]||a} ...
```

Как вы понимаете - это никто не писал, это сгененировала машина для машины.

---

Видите - ничего сложного нет даже в сложных проектах. Внимательно посмотрите документацию, поглядите на имена скриптов в файле package.json, запустите сервер - и любой сайт предстанет перед вами так, как был задуман.








